<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>AR Bed Viewer</title>
    
    <!-- A-Frame per AR -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }

        /* UI Overlay */
        #ui-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        #header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
            padding: 20px;
            color: white;
            pointer-events: auto;
        }

        #title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            pointer-events: auto;
        }

        .btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn.primary {
            background: #4CAF50;
            color: white;
        }

        .btn.secondary {
            background: white;
            color: #333;
        }

        #info-panel {
            position: absolute;
            top: 80px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            pointer-events: auto;
            max-width: 400px;
        }

        #info-panel h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .dimension {
            display: inline-block;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 5px;
            margin-right: 10px;
            margin-bottom: 5px;
        }

        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 18px;
            z-index: 200;
        }

        .hidden {
            display: none !important;
        }

        /* Istruzioni */
        #instructions {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 300px;
            pointer-events: none;
        }

        .marker-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 350px;
        }

        .marker-info img {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border: 2px solid white;
            border-radius: 10px;
        }

        .qr-code {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px auto;
            width: fit-content;
        }

        @media (max-width: 600px) {
            #controls {
                flex-direction: column;
                bottom: 10px;
            }
            
            .btn {
                width: 200px;
                justify-content: center;
            }
        }

        /* Scene container */
        #ar-scene {
            width: 100vw;
            height: 100vh;
        }

        a-scene {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading">
        <div>üõèÔ∏è Caricamento AR...</div>
    </div>

    <!-- UI Container -->
    <div id="ui-container">
        <!-- Header -->
        <div id="header">
            <div id="title">üõèÔ∏è AR Bed Viewer</div>
        </div>

        <!-- Info Panel -->
        <div id="info-panel">
            <h3>Letto Singolo Moderno</h3>
            <p style="color: #666; margin-bottom: 10px;">Dimensioni reali in scala 1:1</p>
            <div>
                <span class="dimension">üìè L: 190cm</span>
                <span class="dimension">üìê W: 80cm</span>
                <span class="dimension">üìä H: 45cm</span>
            </div>
        </div>

        <!-- Instructions -->
        <div id="instructions" class="hidden">
            <p>üì± Inquadra il marker con la fotocamera</p>
            <p style="font-size: 12px; margin-top: 5px; opacity: 0.8;">Il letto apparir√† sopra il marker</p>
        </div>

        <!-- Controls -->
        <div id="controls">
            <button class="btn primary" onclick="startAR()">
                <span>üì∑</span>
                <span>Avvia AR</span>
            </button>
            <button class="btn secondary" onclick="showMarker()">
                <span>üéØ</span>
                <span>Mostra Marker</span>
            </button>
            <button class="btn secondary" onclick="resetView()">
                <span>üîÑ</span>
                <span>Reset</span>
            </button>
        </div>
    </div>

    <!-- Marker Info Modal -->
    <div id="marker-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 300;">
        <div class="marker-info">
            <h2 style="margin-bottom: 15px;">üìç Marker AR</h2>
            <p style="margin-bottom: 20px;">Stampa questo marker o visualizzalo su un altro schermo</p>
            
            <!-- Hiro Marker Pattern -->
            <div class="qr-code">
                <svg width="200" height="200" viewBox="0 0 200 200">
                    <!-- Bordo esterno -->
                    <rect width="200" height="200" fill="white"/>
                    <rect x="10" y="10" width="180" height="180" fill="black"/>
                    <rect x="20" y="20" width="160" height="160" fill="white"/>
                    
                    <!-- Pattern HIRO semplificato -->
                    <rect x="40" y="40" width="40" height="40" fill="black"/>
                    <rect x="50" y="50" width="20" height="20" fill="white"/>
                    
                    <rect x="120" y="40" width="40" height="40" fill="black"/>
                    <rect x="130" y="50" width="20" height="20" fill="white"/>
                    
                    <rect x="80" y="80" width="40" height="40" fill="black"/>
                    
                    <rect x="40" y="120" width="40" height="40" fill="black"/>
                    <rect x="50" y="130" width="20" height="20" fill="white"/>
                    
                    <rect x="120" y="120" width="40" height="40" fill="black"/>
                    <rect x="130" y="130" width="20" height="20" fill="white"/>
                </svg>
            </div>
            
            <button class="btn primary" onclick="closeMarker()" style="margin: 0 auto; display: block;">
                Chiudi
            </button>
        </div>
    </div>

    <!-- A-Frame AR Scene -->
    <div id="ar-scene" class="hidden">
        <a-scene
            embedded
            arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
            
            <!-- Camera -->
            <a-entity camera></a-entity>

            <!-- Marker basato su pattern Hiro -->
            <a-marker preset="hiro">
                <!-- Letto (usando forme primitive) -->
                <a-entity id="bed-model">
                    <!-- Base del letto -->
                    <a-box 
                        position="0 0.225 0" 
                        width="0.8" 
                        height="0.15" 
                        depth="1.9"
                        color="#8B4513"
                        shadow>
                    </a-box>
                    
                    <!-- Materasso -->
                    <a-box 
                        position="0 0.375 0" 
                        width="0.8" 
                        height="0.15" 
                        depth="1.9"
                        color="#F5F5DC"
                        shadow>
                    </a-box>
                    
                    <!-- Testiera -->
                    <a-box 
                        position="0 0.675 -0.95" 
                        width="0.85" 
                        height="0.75" 
                        depth="0.05"
                        color="#654321"
                        shadow>
                    </a-box>
                    
                    <!-- Cuscino -->
                    <a-box 
                        position="0 0.45 -0.7" 
                        width="0.6" 
                        height="0.1" 
                        depth="0.4"
                        color="#FFFFFF"
                        shadow>
                    </a-box>
                    
                    <!-- Gambe del letto -->
                    <a-cylinder 
                        position="-0.35 0.075 -0.9" 
                        radius="0.03" 
                        height="0.15"
                        color="#654321">
                    </a-cylinder>
                    <a-cylinder 
                        position="0.35 0.075 -0.9" 
                        radius="0.03" 
                        height="0.15"
                        color="#654321">
                    </a-cylinder>
                    <a-cylinder 
                        position="-0.35 0.075 0.9" 
                        radius="0.03" 
                        height="0.15"
                        color="#654321">
                    </a-cylinder>
                    <a-cylinder 
                        position="0.35 0.075 0.9" 
                        radius="0.03" 
                        height="0.15"
                        color="#654321">
                    </a-cylinder>
                </a-entity>

                <!-- Illuminazione -->
                <a-light type="ambient" color="#ffffff" intensity="0.5"></a-light>
                <a-light type="directional" color="#ffffff" intensity="0.8" position="1 1 1"></a-light>
            </a-marker>

            <!-- Ground -->
            <a-entity light="type: ambient; color: #BBB"></a-entity>
        </a-scene>
    </div>

    <script>
        let arStarted = false;

        // Start AR Experience
        function startAR() {
            document.getElementById('loading').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('ar-scene').classList.remove('hidden');
                document.getElementById('info-panel').classList.add('hidden');
                document.getElementById('instructions').classList.remove('hidden');
                document.getElementById('loading').classList.add('hidden');
                arStarted = true;
                
                // Nasconde le istruzioni dopo 5 secondi
                setTimeout(() => {
                    document.getElementById('instructions').classList.add('hidden');
                }, 5000);
            }, 1000);
        }

        // Show Marker
        function showMarker() {
            document.getElementById('marker-modal').classList.remove('hidden');
        }

        // Close Marker Modal
        function closeMarker() {
            document.getElementById('marker-modal').classList.add('hidden');
        }

        // Reset View
        function resetView() {
            if (arStarted) {
                document.getElementById('ar-scene').classList.add('hidden');
                document.getElementById('info-panel').classList.remove('hidden');
                document.getElementById('instructions').classList.add('hidden');
                arStarted = false;
            }
        }

        // Rimuovi loading screen all'avvio
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1500);
        });

        // Gestione marker trovato/perso
        document.addEventListener('DOMContentLoaded', function() {
            const marker = document.querySelector('a-marker');
            if (marker) {
                marker.addEventListener('markerFound', function() {
                    console.log('Marker trovato!');
                });
                
                marker.addEventListener('markerLost', function() {
                    console.log('Marker perso!');
                });
            }
        });
    </script>
</body>
</html>